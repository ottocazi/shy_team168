<?xml version="1.0" encoding="UTF-8"?>

<!-- =====   mapper 기본설정 ===== -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 

<!-- =====   루트엘리먼트 & 네임스페이스 설정(프로젝트 전체 내에서 고유해야 한다.) ===== -->
<mapper namespace="pa">

	<!-- ===== 6. Ajax 로 검색어 입력시 자동글 완성하기 =====  -->
	<resultMap type="java.util.HashMap" id="getSearchWordMap">
		<result property="SEARCHDATA" column="searchdata" javaType="String" />
	</resultMap>
	<select id="searchWordgrpList" parameterType="java.util.HashMap" resultMap="getSearchWordMap"> 
		<if test='colname.equals("gname")'>
		    select gname as searchdata 
		    from tbl_group
		    where lower(gname) like '%' || lower(#{grpsearch}) || '%'
		</if>
		
		<if test='colname.equals("gcontent")'>
		    select substr(gcontent, instr(gcontent, #{grpsearch}, 1, 1), length(#{grpsearch}) + 5 )
		           as searchdata    
		    from tbl_grpboard
		    where lower(gcontent) like '%' || lower(#{grpsearch}) || '%'
		</if>
	</select>
	
	<!-- ===== 그룹만들기 ===== -->	
	<insert id="grpinsert" parameterType="com.team168.shy.model.GroupVO">
		insert into tbl_group(groupno, fk_idx, gname, description, gimg, status, groupdate,gcount)
		values(seq_tbl_group.nextval, #{fk_idx}, #{gname}, #{description}, #{gimg}, #{status} , default,default)
	</insert>
	
	<!-- ===== 그룹멤버 insert ===== -->	
	<insert id="gmemberinsert" parameterType="java.util.HashMap">
		insert into tbl_gmember(gpdetailno,fk_groupno,fk_groupidx,gregisterdate,status) 
		values(seq_tbl_gmember.nextval,#{fk_groupno},#{fk_groupidx},default,default)
	</insert>
	
	<!-- ===== 인기그룹 가져오기 =====  -->
	<select id="hotGrpList" resultType="com.team168.shy.model.GroupVO"> 
		 select  groupno, fk_idx, gname, description, gimg, status, groupdate, gcount,
				 rank() over (order by gcount desc) as rank
		 from tbl_group
		 order by rank
	</select>
	
	<!-- ===== 인기그룹 가져오기 =====  -->
	<select id="selectGvo" resultType="com.team168.shy.model.GroupVO"> 
		 select  groupno, fk_idx, gname, description, gimg, status, groupdate, gcount
		 from tbl_group
		 order by groupno desc
	</select>
	
</mapper>	